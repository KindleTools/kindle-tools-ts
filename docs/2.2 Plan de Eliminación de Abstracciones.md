# ğŸ“‹ 2.2 Plan de EliminaciÃ³n de Abstracciones

> Plan para simplificar abstracciones innecesarias - 18 de enero de 2026

## Resumen

| Elemento | Tipo | Riesgo | DecisiÃ³n |
|----------|------|--------|----------|
| `AuthorNormalizer` | Clase static-only | ğŸŸ¢ Bajo | Convertir a funciones |
| `TemplateEngineFactory` | Factory/Cache | ğŸŸ¡ Medio | Simplificar a funciÃ³n |
| `types/geo.ts` duplicado | Interface | ğŸŸ¢ Bajo | Ya en Plan 2.1 |

---

## Elemento 1: AuthorNormalizer

### AnÃ¡lisis

| Campo | Valor |
|-------|-------|
| **Archivo** | `src/utils/text/author-normalizer.ts` |
| **Tipo** | Clase con solo mÃ©todos estÃ¡ticos |
| **LÃ­neas** | 61 |
| **Usos en producciÃ³n** | 0 |
| **Usos en tests** | 1 archivo (`tests/unit/utils/author-normalizer.test.ts`) |

### DecisiÃ³n: Convertir a funciones exportadas

**RazÃ³n**: Clase innecesaria. Los mÃ©todos estÃ¡ticos son funcionalmente equivalentes a funciones exportadas pero con mÃ¡s ceremonia sintÃ¡ctica.

### Pasos de ImplementaciÃ³n

```
Paso 1: Refactorizar clase a funciones
        - Cambiar `class AuthorNormalizer` a funciones exportadas
        - `normalize()` â†’ `export function normalizeAuthor()`
        - `getSimilarity()` â†’ `export function getAuthorSimilarity()`  
        - `areSameAuthor()` â†’ mantener nombre

Paso 2: Actualizar tests
        - Cambiar imports en author-normalizer.test.ts
        - `AuthorNormalizer.normalize()` â†’ `normalizeAuthor()`

Paso 3: Verificar
        - pnpm typecheck
        - pnpm test
```

### Archivos Afectados

```
1. src/utils/text/author-normalizer.ts â†’ Refactorizar
2. tests/unit/utils/author-normalizer.test.ts â†’ Actualizar imports
```

### CÃ³digo Antes/DespuÃ©s

**Antes:**
```typescript
export class AuthorNormalizer {
  static normalize(name: string): string { ... }
  static getSimilarity(a: string, b: string): number { ... }
  static areSameAuthor(a: string, b: string): boolean { ... }
}
```

**DespuÃ©s:**
```typescript
export function normalizeAuthor(name: string): string { ... }
export function getAuthorSimilarity(a: string, b: string): number { ... }
export function areSameAuthor(a: string, b: string): boolean { ... }
```

---

## Elemento 2: TemplateEngineFactory

### AnÃ¡lisis

| Campo | Valor |
|-------|-------|
| **Archivo** | `src/templates/engine.ts` (lÃ­neas 31-85) |
| **Tipo** | Factory/Singleton con caching |
| **LÃ­neas** | ~55 |
| **Usos** | 2 call sites en `multi-file-exporter.ts` |

### DecisiÃ³n: Simplificar a funciÃ³n con memoizaciÃ³n

**RazÃ³n**: La factory solo hace caching de instancias. Una funciÃ³n `getTemplateEngine()` con closure es mÃ¡s simple y logra lo mismo.

### Pasos de ImplementaciÃ³n

```
Paso 1: Crear funciÃ³n getTemplateEngine()
        - Mover lÃ³gica de caching a funciÃ³n con Map privado
        - Mantener misma API: getTemplateEngine(presetOrTemplates)

Paso 2: Actualizar consumidores
        - multi-file-exporter.ts: cambiar import y llamadas

Paso 3: Eliminar clase TemplateEngineFactory
        - Remover clase del archivo engine.ts

Paso 4: Actualizar exports
        - Si la factory estaba exportada, actualizar barrel

Paso 5: Verificar
        - pnpm typecheck
        - pnpm test
```

### Archivos Afectados

```
1. src/templates/engine.ts â†’ Refactorizar factory a funciÃ³n
2. src/exporters/shared/multi-file-exporter.ts â†’ Actualizar imports
```

### CÃ³digo Antes/DespuÃ©s

**Antes:**
```typescript
export class TemplateEngineFactory {
  private static instances = new Map<string, TemplateEngine>();
  
  static getEngine(presetOrTemplates?: string | CustomTemplates): TemplateEngine {
    // caching logic...
  }
  
  static clearCache(): void {
    TemplateEngineFactory.instances.clear();
  }
}
```

**DespuÃ©s:**
```typescript
const engineCache = new Map<string, TemplateEngine>();

export function getTemplateEngine(presetOrTemplates?: string | CustomTemplates): TemplateEngine {
  // Same caching logic, cleaner syntax
}

export function clearTemplateEngineCache(): void {
  engineCache.clear();
}
```

---

## Elemento 3: types/geo.ts (DuplicaciÃ³n)

> âš ï¸ Este elemento ya estÃ¡ incluido en `2.1 Plan de ConsolidaciÃ³n` (Fase 2.3)

**Resumen**: Mover interface `GeoLocation` de `types/geo.ts` a `utils/geo/index.ts` para eliminar duplicaciÃ³n con el schema Zod.

---

## Orden de EjecuciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ORDEN DE ELIMINACIÃ“N DE ABSTRACCIONES            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. AuthorNormalizer â†’ funciones                             â”‚
â”‚    Riesgo: ğŸŸ¢ Bajo (0 usos producciÃ³n, solo tests)          â”‚
â”‚                                                             â”‚
â”‚ 2. TemplateEngineFactory â†’ funciÃ³n con closure              â”‚
â”‚    Riesgo: ğŸŸ¡ Medio (2 call sites, cambio de API)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ejecutar DESPUÃ‰S de Plan 2.1 (consolidaciÃ³n)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## VerificaciÃ³n Post-ImplementaciÃ³n

```bash
# DespuÃ©s de cada elemento:
pnpm typecheck
pnpm test
pnpm build
```

---

## Notas

1. **AuthorNormalizer**: Aunque tiene tests, no tiene uso real en producciÃ³n. Considerar si los tests son necesarios despuÃ©s del refactor.

2. **TemplateEngineFactory**: El cambio es seguro porque mantiene la misma funcionalidad, solo cambia la sintaxis de clase a funciÃ³n.

3. **No eliminar abstracciones justificadas**: Las siguientes abstracciones estÃ¡n BIEN y no deben tocarse:
   - `ImporterFactory` (3 implementaciones, extensible)
   - `ExporterFactory` (6 implementaciones, extensible)
   - `BaseImporter`/`BaseExporter` (herencia correcta)
   - `FileSystem` interface (DI para testing)
   - `Logger` interface (DI para logging)
   - `Archiver` interface (2 implementaciones)
