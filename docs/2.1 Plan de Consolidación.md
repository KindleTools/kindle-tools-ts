# ğŸ“‹ 2.1 Plan de ConsolidaciÃ³n

> Plan de merge para archivos pequeÃ±os - 18 de enero de 2026

## Resumen Ejecutivo

| Fase | Archivos a Eliminar | Riesgo | Impacto |
|------|---------------------|--------|---------|
| Fase 1 | 2 | Bajo | Alto |
| Fase 2 | 3 | Bajo | Medio |
| Fase 3 | 1 | Medio | Bajo |
| **Total** | **6** | - | **-6 archivos** |

---

## Fase 1: Bajo Riesgo, Alto Impacto

### 1.1 Merge `core/limits.ts` â†’ `domain/rules.ts`

| Campo | Valor |
|-------|-------|
| **Origen** | `src/core/limits.ts` (14 lÃ­neas) |
| **Destino** | `src/domain/rules.ts` |
| **RazÃ³n** | `SYSTEM_LIMITS` es una constante de negocio que pertenece junto a `PROCESSING_THRESHOLDS` |
| **Contenido a mover** | `SYSTEM_LIMITS.MAX_FILENAME_LENGTH = 100` |
| **Impacto** | 1 archivo actualiza import: `exporters/shared/exporter-utils.ts` |
| **Riesgo** | ğŸŸ¢ **Bajo** - Solo 1 import que cambiar |
| **Beneficio** | -1 archivo, constantes centralizadas |

**Archivos a modificar:**
```
1. src/domain/rules.ts          â†’ AÃ±adir SYSTEM_LIMITS
2. src/exporters/shared/exporter-utils.ts â†’ Cambiar import
3. src/core/limits.ts           â†’ ELIMINAR
```

---

### 1.2 Merge `importers/shared/constants.ts` â†’ `domain/rules.ts`

| Campo | Valor |
|-------|-------|
| **Origen** | `src/importers/shared/constants.ts` (12 lÃ­neas) |
| **Destino** | `src/domain/rules.ts` |
| **RazÃ³n** | `MAX_VALIDATION_ERRORS` es un threshold de procesamiento |
| **Contenido a mover** | `MAX_VALIDATION_ERRORS = 100` |
| **Impacto** | 3 archivos actualizan imports |
| **Riesgo** | ğŸŸ¢ **Bajo** - Cambios simples de import |
| **Beneficio** | -1 archivo, reglas de negocio centralizadas |

**Archivos a modificar:**
```
1. src/domain/rules.ts                    â†’ AÃ±adir MAX_VALIDATION_ERRORS
2. src/importers/formats/txt/parser.ts    â†’ Cambiar import
3. src/importers/formats/json.importer.ts â†’ Cambiar import  
4. src/importers/formats/csv.importer.ts  â†’ Cambiar import
5. src/importers/shared/constants.ts      â†’ ELIMINAR
6. src/importers/shared/index.ts          â†’ Quitar re-export
```

---

## Fase 2: Bajo Riesgo, Medio Impacto

### 2.1 Merge `utils/text/patterns.ts` â†’ `normalizers.ts`

| Campo | Valor |
|-------|-------|
| **Origen** | `src/utils/text/patterns.ts` (32 lÃ­neas) |
| **Destino** | `src/utils/text/normalizers.ts` |
| **RazÃ³n** | Solo `normalizers.ts` usa estos patterns |
| **Contenido** | 5 regex constants (BOM, MULTIPLE_SPACES, etc.) |
| **Impacto** | 1 archivo: ya importa como `import * as Patterns` |
| **Riesgo** | ğŸŸ¢ **Bajo** - Solo 1 consumidor, internalizar |
| **Beneficio** | -1 archivo, patrones junto a funciones que los usan |

**Archivos a modificar:**
```
1. src/utils/text/normalizers.ts â†’ Mover patterns al inicio del archivo
2. src/utils/text/patterns.ts    â†’ ELIMINAR
```

---

### 2.2 Merge `utils/text/counting.ts` â†’ `normalizers.ts`

| Campo | Valor |
|-------|-------|
| **Origen** | `src/utils/text/counting.ts` (21 lÃ­neas) |
| **Destino** | `src/utils/text/normalizers.ts` |
| **RazÃ³n** | Solo 1 funciÃ³n (`countWords`), usada en 1 lugar |
| **Impacto** | 1 archivo: `importers/formats/txt/parser.ts` |
| **Riesgo** | ğŸŸ¢ **Bajo** - Cambio simple de import |
| **Beneficio** | -1 archivo, utilidades de texto unificadas |

**Archivos a modificar:**
```
1. src/utils/text/normalizers.ts         â†’ AÃ±adir countWords()
2. src/importers/formats/txt/parser.ts   â†’ Cambiar import
3. src/utils/text/counting.ts            â†’ ELIMINAR
```

---

### 2.3 Merge `types/geo.ts` â†’ `utils/geo/index.ts`

| Campo | Valor |
|-------|-------|
| **Origen** | `src/types/geo.ts` (23 lÃ­neas) |
| **Destino** | `src/utils/geo/index.ts` |
| **RazÃ³n** | Interface `GeoLocation` solo usada por utils/geo |
| **Impacto** | 2 archivos que importan el tipo |
| **Riesgo** | ğŸŸ¢ **Bajo** - Solo interface, sin lÃ³gica |
| **Beneficio** | -1 archivo, tipo colocado con sus funciones |

**Archivos a modificar:**
```
1. src/utils/geo/index.ts â†’ Mover interface GeoLocation aquÃ­
2. src/types/geo.ts       â†’ ELIMINAR
3. src/types/index.ts     â†’ Quitar re-export de geo.js
4. Actualizar imports que usen #app-types/geo
```

---

## Fase 3: Medio Riesgo, Bajo Impacto

### 3.1 Eliminar `AuthorNormalizer` (clase muerta)

| Campo | Valor |
|-------|-------|
| **Archivo** | `src/utils/text/author-normalizer.ts` (61 lÃ­neas) |
| **AcciÃ³n** | ELIMINAR completamente |
| **RazÃ³n** | Clase nunca importada ni usada en ningÃºn lugar |
| **Impacto** | 0 archivos (no hay imports) |
| **Riesgo** | ğŸŸ¡ **Medio** - Verificar que realmente nadie la usa |
| **Beneficio** | -61 lÃ­neas de cÃ³digo muerto |

**VerificaciÃ³n antes de eliminar:**
```bash
# Confirmar 0 usos:
grep -r "AuthorNormalizer" src/
grep -r "author-normalizer" src/
```

---

## Orden de EjecuciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ORDEN RECOMENDADO                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Fase 1.1: limits.ts â†’ rules.ts (1 import)                â”‚
â”‚ 2. Fase 1.2: constants.ts â†’ rules.ts (3 imports)            â”‚
â”‚ 3. Fase 2.1: patterns.ts â†’ normalizers.ts (internalizar)    â”‚
â”‚ 4. Fase 2.2: counting.ts â†’ normalizers.ts (1 import)        â”‚
â”‚ 5. Fase 2.3: types/geo.ts â†’ utils/geo (interface)           â”‚
â”‚ 6. Fase 3.1: Eliminar AuthorNormalizer                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Total archivos eliminados: 6                                â”‚
â”‚ Total lÃ­neas recuperadas: ~163                              â”‚
â”‚ Archivos a modificar: ~12                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## VerificaciÃ³n Post-ConsolidaciÃ³n

```bash
# DespuÃ©s de cada fase:
pnpm typecheck
pnpm test
pnpm build
```

---

## Notas Importantes

1. **Barrel files**: Actualizar `index.ts` correspondientes despuÃ©s de cada merge
2. **Tests**: Buscar tests que importen los archivos eliminados
3. **Commits**: Un commit por fase para facilitar rollback
4. **Orden estricto**: No saltar fases, cada una depende de la anterior pasando tests
